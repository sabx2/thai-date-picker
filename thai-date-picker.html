<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <title>Thai Date Picker - Test</title>
  <style>
    body {
      font-family: 'Sarabun', 'Kanit', system-ui, sans-serif;
      padding: 40px;
      background: #f5f5f5;
    }

    .test-container {
      max-width: 600px;
      margin: 0 auto;
      background: white;
      padding: 30px;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }

    h2 {
      margin-bottom: 20px;
    }

    .form-group {
      margin-bottom: 20px;
    }

    label {
      display: block;
      margin-bottom: 5px;
      font-weight: 600;
    }

    button {
      padding: 10px 20px;
      margin: 5px;
      cursor: pointer;
    }

    .result {
      margin-top: 20px;
      padding: 15px;
      background: #f0f0f0;
      border-radius: 5px;
    }

    /* Thai Date Picker Styles */
    .thai-date-picker {
      position: relative;
      display: inline-block;
      width: 100%;
      max-width: 100%;
    }

    .thai-date-input {
      width: 100%;
      padding: 12px 40px 12px 16px;
      font-size: 16px;
      border: 2px solid #ddd;
      border-radius: 12px;
      background: white;
      transition: all 0.3s ease;
    }

    .thai-date-input:focus {
      outline: none;
      border-color: #4F46E5;
      box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.2);
    }

    .calendar-icon {
      position: absolute;
      right: 12px;
      top: 50%;
      transform: translateY(-50%);
      pointer-events: none;
      color: #666;
      font-size: 20px;
    }

    .calendar-popup {
      position: absolute;
      top: 100%;
      left: 0;
      right: 0;
      margin-top: 8px;
      background: white;
      border: 1px solid #ddd;
      border-radius: 12px;
      box-shadow: 0 10px 25px rgba(0,0,0,0.15);
      padding: 16px;
      z-index: 1000;
      display: none;
    }

    .calendar-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 12px;
      gap: 8px;
    }

    .month-year-select {
      display: flex;
      gap: 8px;
      align-items: center;
      flex: 1;
      justify-content: center;
    }

    .month-select, .year-select {
      padding: 6px 10px;
      font-size: 15px;
      border: 1px solid #ccc;
      border-radius: 8px;
      background: white;
      cursor: pointer;
    }

    .month-select { min-width: 120px; }
    .year-select { min-width: 90px; }

    .calendar-nav {
      background: none;
      border: none;
      font-size: 24px;
      cursor: pointer;
      padding: 4px 8px;
      border-radius: 8px;
      width: 36px;
      height: 36px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #4F46E5;
      font-weight: bold;
    }

    .calendar-nav:hover { 
      background: #f0f0f0; 
    }

    .calendar-grid {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 4px;
      text-align: center;
    }

    .calendar-day-header {
      font-weight: bold;
      color: #666;
      padding: 8px 0;
      font-size: 14px;
    }

    .calendar-day {
      padding: 10px;
      cursor: pointer;
      border-radius: 8px;
      transition: all 0.2s;
      font-size: 14px;
    }

    .calendar-day:hover { 
      background: #4F46E5; 
      color: white; 
    }

    .calendar-day.today { 
      background: #E0E7FF; 
      color: #4F46E5; 
      font-weight: bold; 
    }

    .calendar-day.selected { 
      background: #4F46E5; 
      color: white; 
      font-weight: bold; 
    }

    .calendar-day.other-month { 
      color: #bbb;
    }
  </style>
</head>
<body>

<div class="test-container">
  <h2>‡∏ó‡∏î‡∏™‡∏≠‡∏ö Thai Date Picker</h2>

  <div class="form-group">
    <label>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà 1:</label>
    <div class="thai-date-picker" id="picker1">
      <input type="text" class="thai-date-input" placeholder="‡∏ß‡∏ß/‡∏î‡∏î/‡∏õ‡∏õ‡∏õ‡∏õ ‡πÄ‡∏ä‡πà‡∏ô 14/12/2568">
      <span class="calendar-icon">üìÖ</span>
      <input type="hidden" class="date-hidden-value">

      <div class="calendar-popup">
        <div class="calendar-header">
          <button type="button" class="calendar-nav prev">‚Äπ</button>
          <div class="month-year-select">
            <select class="month-select"></select>
            <select class="year-select"></select>
          </div>
          <button type="button" class="calendar-nav next">‚Ä∫</button>
        </div>
        <div class="calendar-grid">
          <div class="calendar-day-header">‡∏≠‡∏≤</div>
          <div class="calendar-day-header">‡∏à</div>
          <div class="calendar-day-header">‡∏≠</div>
          <div class="calendar-day-header">‡∏û</div>
          <div class="calendar-day-header">‡∏û‡∏§</div>
          <div class="calendar-day-header">‡∏®</div>
          <div class="calendar-day-header">‡∏™</div>
        </div>
      </div>
    </div>
  </div>

  <div class="form-group">
    <label>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà 2:</label>
    <div class="thai-date-picker" id="picker2">
      <input type="text" class="thai-date-input" placeholder="‡∏ß‡∏ß/‡∏î‡∏î/‡∏õ‡∏õ‡∏õ‡∏õ ‡πÄ‡∏ä‡πà‡∏ô 25/12/2568">
      <span class="calendar-icon">üìÖ</span>
      <input type="hidden" class="date-hidden-value">

      <div class="calendar-popup">
        <div class="calendar-header">
          <button type="button" class="calendar-nav prev">‚Äπ</button>
          <div class="month-year-select">
            <select class="month-select"></select>
            <select class="year-select"></select>
          </div>
          <button type="button" class="calendar-nav next">‚Ä∫</button>
        </div>
        <div class="calendar-grid">
          <div class="calendar-day-header">‡∏≠‡∏≤</div>
          <div class="calendar-day-header">‡∏à</div>
          <div class="calendar-day-header">‡∏≠</div>
          <div class="calendar-day-header">‡∏û</div>
          <div class="calendar-day-header">‡∏û‡∏§</div>
          <div class="calendar-day-header">‡∏®</div>
          <div class="calendar-day-header">‡∏™</div>
        </div>
      </div>
    </div>
  </div>

  <button onclick="showValues()">‡πÅ‡∏™‡∏î‡∏á‡∏Ñ‡πà‡∏≤</button>
  <button onclick="clearAll()">‡∏•‡πâ‡∏≤‡∏á‡∏Ñ‡πà‡∏≤</button>

  <div class="result" id="result" style="display:none;">
    <div><strong>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà 1 (‡πÑ‡∏ó‡∏¢):</strong> <span id="val1-th"></span></div>
    <div><strong>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà 1 (ISO):</strong> <span id="val1-iso"></span></div>
    <div><strong>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà 2 (‡πÑ‡∏ó‡∏¢):</strong> <span id="val2-th"></span></div>
    <div><strong>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà 2 (ISO):</strong> <span id="val2-iso"></span></div>
  </div>
</div>

<script>
  const THAI_MONTHS = ['‡∏°‡∏Å‡∏£‡∏≤‡∏Ñ‡∏°','‡∏Å‡∏∏‡∏°‡∏†‡∏≤‡∏û‡∏±‡∏ô‡∏ò‡πå','‡∏°‡∏µ‡∏ô‡∏≤‡∏Ñ‡∏°','‡πÄ‡∏°‡∏©‡∏≤‡∏¢‡∏ô','‡∏û‡∏§‡∏©‡∏†‡∏≤‡∏Ñ‡∏°','‡∏°‡∏¥‡∏ñ‡∏∏‡∏ô‡∏≤‡∏¢‡∏ô',
                       '‡∏Å‡∏£‡∏Å‡∏é‡∏≤‡∏Ñ‡∏°','‡∏™‡∏¥‡∏á‡∏´‡∏≤‡∏Ñ‡∏°','‡∏Å‡∏±‡∏ô‡∏¢‡∏≤‡∏¢‡∏ô','‡∏ï‡∏∏‡∏•‡∏≤‡∏Ñ‡∏°','‡∏û‡∏§‡∏®‡∏à‡∏¥‡∏Å‡∏≤‡∏¢‡∏ô','‡∏ò‡∏±‡∏ô‡∏ß‡∏≤‡∏Ñ‡∏°'];

  function initThaiDatePicker(root) {
    const input = root.querySelector('.thai-date-input');
    const hidden = root.querySelector('.date-hidden-value');
    const popup = root.querySelector('.calendar-popup');
    const monthSelect = popup.querySelector('.month-select');
    const yearSelect = popup.querySelector('.year-select');
    const grid = popup.querySelector('.calendar-grid');

    let viewDate = new Date();
    let selectedDate = null;

    // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏î‡∏∑‡∏≠‡∏ô
    THAI_MONTHS.forEach((month, i) => {
      const opt = document.createElement('option');
      opt.value = i;
      opt.textContent = month;
      monthSelect.appendChild(opt);
    });

    // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏õ‡∏µ (¬±10 ‡∏õ‡∏µ)
    const currentYear = new Date().getFullYear();
    for (let y = currentYear - 10; y <= currentYear + 10; y++) {
      const opt = document.createElement('option');
      opt.value = y;
      opt.textContent = y + 543;
      yearSelect.appendChild(opt);
    }

    function updateHeader() {
      monthSelect.value = viewDate.getMonth();
      yearSelect.value = viewDate.getFullYear();
    }

    function showPopup() {
      popup.style.display = 'block';
      updateHeader();
      renderCalendar();
    }

    function hidePopup() { 
      popup.style.display = 'none'; 
    }

    function renderCalendar() {
      const year = viewDate.getFullYear();
      const month = viewDate.getMonth();

      while (grid.children.length > 7) grid.removeChild(grid.lastChild);

      const firstDay = new Date(year, month, 1);
      const startOffset = firstDay.getDay();
      const startDate = new Date(firstDay);
      startDate.setDate(firstDay.getDate() - startOffset);

      for (let i = 0; i < 42; i++) {
        const current = new Date(startDate);
        current.setDate(startDate.getDate() + i);

        const dayEl = document.createElement('div');
        dayEl.className = 'calendar-day';
        dayEl.textContent = current.getDate();

        if (current.getMonth() !== month) {
          dayEl.classList.add('other-month');
        } else {
          dayEl.addEventListener('click', () => selectDate(current));
        }

        if (isToday(current)) dayEl.classList.add('today');
        if (selectedDate && isSameDay(current, selectedDate)) dayEl.classList.add('selected');

        grid.appendChild(dayEl);
      }
    }

    function selectDate(date) {
      selectedDate = new Date(date);
      input.value = formatThai(selectedDate);
      hidden.value = formatISO(selectedDate);
      root.dispatchEvent(new Event('date-selected'));
      renderCalendar();
      hidePopup();
    }

    function parseThai(text) {
      const match = text.trim().match(/^(\d{1,2})\/(\d{1,2})\/(\d{4})$/);
      if (!match) {
        hidden.value = '';
        return;
      }
      const d = parseInt(match[1], 10);
      const m = parseInt(match[2], 10) - 1;
      const y = parseInt(match[3], 10) - 543;
      
      const date = new Date(y, m, d);
      if (date.getFullYear() === y && date.getMonth() === m && date.getDate() === d) {
        selectedDate = date;
        hidden.value = formatISO(date);
        viewDate = new Date(y, m, 1);
        updateHeader();
        renderCalendar();
      }
    }

    function formatThai(date) {
      return String(date.getDate()).padStart(2,'0') + '/' +
             String(date.getMonth()+1).padStart(2,'0') + '/' +
             (date.getFullYear() + 543);
    }

    function formatISO(date) {
      return date.getFullYear() + '-' +
             String(date.getMonth()+1).padStart(2,'0') + '-' +
             String(date.getDate()).padStart(2,'0');
    }

    function isToday(date) { return isSameDay(date, new Date()); }
    function isSameDay(d1, d2) {
      return d1.getFullYear() === d2.getFullYear() &&
             d1.getMonth() === d2.getMonth() &&
             d1.getDate() === d2.getDate();
    }

    // Events
    input.addEventListener('click', () => {
      popup.style.display === 'block' ? hidePopup() : showPopup();
    });
    
    input.addEventListener('input', e => parseThai(e.target.value));

    popup.querySelector('.prev').addEventListener('click', () => {
      viewDate.setMonth(viewDate.getMonth() - 1);
      updateHeader();
      renderCalendar();
    });

    popup.querySelector('.next').addEventListener('click', () => {
      viewDate.setMonth(viewDate.getMonth() + 1);
      updateHeader();
      renderCalendar();
    });

    monthSelect.addEventListener('change', () => {
      viewDate.setMonth(parseInt(monthSelect.value));
      renderCalendar();
    });

    yearSelect.addEventListener('change', () => {
      viewDate.setFullYear(parseInt(yearSelect.value));
      renderCalendar();
    });

    document.addEventListener('click', e => {
      if (!root.contains(e.target)) hidePopup();
    });

    renderCalendar();
  }

  // Initialize all pickers
  document.addEventListener('DOMContentLoaded', () => {
    document.querySelectorAll('.thai-date-picker').forEach(picker => {
      initThaiDatePicker(picker);
    });
  });

  // Test functions
  function showValues() {
    const picker1 = document.getElementById('picker1');
    const picker2 = document.getElementById('picker2');
    
    const input1 = picker1.querySelector('.thai-date-input').value;
    const hidden1 = picker1.querySelector('.date-hidden-value').value;
    const input2 = picker2.querySelector('.thai-date-input').value;
    const hidden2 = picker2.querySelector('.date-hidden-value').value;

    document.getElementById('val1-th').textContent = input1 || '-';
    document.getElementById('val1-iso').textContent = hidden1 || '-';
    document.getElementById('val2-th').textContent = input2 || '-';
    document.getElementById('val2-iso').textContent = hidden2 || '-';
    
    document.getElementById('result').style.display = 'block';
  }

  function clearAll() {
    document.querySelectorAll('.thai-date-picker').forEach(picker => {
      picker.querySelector('.thai-date-input').value = '';
      picker.querySelector('.date-hidden-value').value = '';
    });
    document.getElementById('result').style.display = 'none';
  }
</script>

</body>
</html>
